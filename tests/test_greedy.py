from macpacking.reader import BinppReader
from macpacking.algorithms.GreedyPartition import GreedyPartition


def test_greedy():
    dataset = '_datasets/binpp/N1C1W1/N1C1W1_B.BPP.txt'
    oracle = [[100, 69, 66, 23, 18],
              [99, 70, 63, 37, 12],
              [97, 75, 50, 43, 14],
              [97, 72, 62, 39, 8],
              [97, 71, 67, 20, 19],
              [93, 76, 62, 37, 13],
              [93, 76, 61, 40, 8],
              [92, 83, 44, 44, 15],
              [92, 79, 61, 30, 17],
              [88, 83, 51, 43, 13]]
    greedy = GreedyPartition()
    data = BinppReader(dataset).offline()
    sol = greedy((10, data[1]))
    assert oracle == sol

    dataset = '_datasets/binpp/N2C1W1/N2C1W1_B.BPP.txt'
    oracle = [[100, 84, 84, 80, 78, 71, 68, 55, 48, 45, 42, 40, 34, 29, 28, 18, 18, 12, 8, 3], 
              [99, 93, 83, 79, 76, 69, 66, 54, 49, 45, 42, 40, 33, 32, 24, 22, 17, 11, 7, 5], 
              [99, 89, 83, 79, 77, 71, 67, 53, 50, 45, 42, 39, 34, 32, 24, 22, 17, 10, 10, 2], 
              [98, 96, 82, 79, 74, 70, 62, 56, 50, 47, 41, 38, 36, 28, 28, 22, 14, 14, 7, 3], 
              [98, 96, 81, 79, 75, 69, 67, 51, 50, 48, 41, 37, 36, 31, 26, 21, 15, 12, 9, 2]]
    greedy = GreedyPartition()
    data = BinppReader(dataset).offline()
    sol = greedy((5, data[1]))
    assert oracle == sol

    dataset = '_datasets/binpp/N3C1W1/N3C1W1_B.BPP.txt'
    oracle = [[100, 99, 93, 92, 89, 88, 86, 85, 83, 77, 75, 74, 71, 71, 68, 68, 65, 63, 60, 58, 57, 52, 48, 47, 44, 40, 39, 36, 36, 33, 31, 27, 26, 23, 14, 13, 13, 9, 7, 3], 
              [100, 99, 93, 92, 89, 88, 86, 85, 83, 77, 75, 74, 71, 70, 70, 67, 64, 64, 59, 59, 56, 52, 49, 46, 44, 40, 39, 38, 33, 33, 32, 30, 24, 21, 16, 13, 13, 7, 7, 5], 
              [100, 99, 92, 92, 90, 88, 86, 85, 81, 80, 74, 74, 71, 70, 69, 67, 66, 62, 61, 58, 53, 53, 50, 48, 44, 40, 38, 37, 34, 33, 32, 29, 25, 21, 15, 14, 12, 10, 6, 4], 
              [100, 98, 98, 90, 89, 87, 86, 84, 81, 79, 75, 73, 73, 70, 68, 67, 65, 63, 61, 57, 57, 52, 49, 45, 44, 42, 38, 37, 34, 33, 32, 28, 26, 20, 17, 13, 12, 9, 7, 3], 
              [100, 98, 95, 91, 89, 88, 86, 84, 84, 77, 75, 73, 72, 70, 68, 68, 65, 63, 60, 59, 53, 52, 51, 48, 42, 41, 39, 36, 36, 33, 32, 27, 26, 20, 16, 14, 11, 11, 5, 4]]
    greedy = GreedyPartition()
    data = BinppReader(dataset).offline()
    sol = greedy((5, data[1]))
    assert oracle == sol
    